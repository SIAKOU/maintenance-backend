{"fields":null,"level":"error","message":"Erreur mise à jour utilisateur: une instruction insert ou update sur la table « audit_logs » viole la contrainte de clé\nétrangère « audit_logs_user_id_fkey »","name":"SequelizeForeignKeyConstraintError","original":{"code":"23503","constraint":"audit_logs_user_id_fkey","detail":"La clé (user_id)=(1) n'est pas présente dans la table « users ».","file":"ri_triggers.c","length":827,"line":"2610","name":"error","parameters":["avatar-1752963068723-756318804.jpeg","REMI.jpeg","uploads\\avatars\\avatar-1752963068723-756318804.jpeg","image/jpeg",752464,"image","avatar","Avatar pour SIAKOU Komi Stanislas",5,5,"2025-07-19 22:11:08.790 +00:00","2025-07-19 22:11:08.790 +00:00"],"routine":"ri_ReportViolation","schema":"public","severity":"ERREUR","sql":"INSERT INTO \"file_attachments\" (\"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12) RETURNING \"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"intervention_id\",\"report_id\",\"machine_id\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\",\"uploaded_by\",\"intervention_id\",\"report_id\";","table":"audit_logs","where":"instruction SQL « INSERT INTO audit_logs (\n        user_id,\n        action,\n        entity,\n        entity_id,\n        changes,\n        ip_address,\n        user_agent,\n        created_at\n    ) VALUES (\n        effective_user_id,\n        operation,\n        TG_TABLE_NAME,\n        COALESCE(NEW.id, OLD.id),\n        changes,\n        current_setting('app.current_ip', TRUE),\n        current_setting('app.user_agent', TRUE),\n        NOW()\n    ) »\nfonction PL/pgSQL log_audit_trail(), ligne 28 à instruction SQL"},"parameters":["avatar-1752963068723-756318804.jpeg","REMI.jpeg","uploads\\avatars\\avatar-1752963068723-756318804.jpeg","image/jpeg",752464,"image","avatar","Avatar pour SIAKOU Komi Stanislas",5,5,"2025-07-19 22:11:08.790 +00:00","2025-07-19 22:11:08.790 +00:00"],"parent":{"code":"23503","constraint":"audit_logs_user_id_fkey","detail":"La clé (user_id)=(1) n'est pas présente dans la table « users ».","file":"ri_triggers.c","length":827,"line":"2610","name":"error","parameters":["avatar-1752963068723-756318804.jpeg","REMI.jpeg","uploads\\avatars\\avatar-1752963068723-756318804.jpeg","image/jpeg",752464,"image","avatar","Avatar pour SIAKOU Komi Stanislas",5,5,"2025-07-19 22:11:08.790 +00:00","2025-07-19 22:11:08.790 +00:00"],"routine":"ri_ReportViolation","schema":"public","severity":"ERREUR","sql":"INSERT INTO \"file_attachments\" (\"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12) RETURNING \"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"intervention_id\",\"report_id\",\"machine_id\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\",\"uploaded_by\",\"intervention_id\",\"report_id\";","table":"audit_logs","where":"instruction SQL « INSERT INTO audit_logs (\n        user_id,\n        action,\n        entity,\n        entity_id,\n        changes,\n        ip_address,\n        user_agent,\n        created_at\n    ) VALUES (\n        effective_user_id,\n        operation,\n        TG_TABLE_NAME,\n        COALESCE(NEW.id, OLD.id),\n        changes,\n        current_setting('app.current_ip', TRUE),\n        current_setting('app.user_agent', TRUE),\n        NOW()\n    ) »\nfonction PL/pgSQL log_audit_trail(), ligne 28 à instruction SQL"},"sql":"INSERT INTO \"file_attachments\" (\"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12) RETURNING \"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"intervention_id\",\"report_id\",\"machine_id\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\",\"uploaded_by\",\"intervention_id\",\"report_id\";","stack":"Error\n    at Query.run (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\postgres\\query.js:50:25)\n    at F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\sequelize.js:315:28\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PostgresQueryInterface.insert (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-interface.js:308:21)\n    at async model.save (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\model.js:2490:35)\n    at async FileAttachment.create (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\model.js:1362:12)\n    at async updateUser (F:\\gestion-maintenance\\backend\\controllers\\userController.js:172:7)","timestamp":"2025-07-19 22:11:08"}
{"fields":null,"level":"error","message":"Erreur mise à jour utilisateur: une instruction insert ou update sur la table « audit_logs » viole la contrainte de clé\nétrangère « audit_logs_user_id_fkey »","name":"SequelizeForeignKeyConstraintError","original":{"code":"23503","constraint":"audit_logs_user_id_fkey","detail":"La clé (user_id)=(2) n'est pas présente dans la table « users ».","file":"ri_triggers.c","length":827,"line":"2610","name":"error","parameters":["avatar-1752963687318-794504727.jpeg","REMI.jpeg","uploads\\avatars\\avatar-1752963687318-794504727.jpeg","image/jpeg",752464,"image","avatar","Avatar pour SIAKOU Komi Stanislas",5,5,"2025-07-19 22:21:27.376 +00:00","2025-07-19 22:21:27.376 +00:00"],"routine":"ri_ReportViolation","schema":"public","severity":"ERREUR","sql":"INSERT INTO \"file_attachments\" (\"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12) RETURNING \"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"intervention_id\",\"report_id\",\"machine_id\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\",\"uploaded_by\",\"intervention_id\",\"report_id\";","table":"audit_logs","where":"instruction SQL « INSERT INTO audit_logs (\n        user_id,\n        action,\n        entity,\n        entity_id,\n        changes,\n        ip_address,\n        user_agent,\n        created_at\n    ) VALUES (\n        effective_user_id,\n        operation,\n        TG_TABLE_NAME,\n        COALESCE(NEW.id, OLD.id),\n        changes,\n        current_setting('app.current_ip', TRUE),\n        current_setting('app.user_agent', TRUE),\n        NOW()\n    ) »\nfonction PL/pgSQL log_audit_trail(), ligne 28 à instruction SQL"},"parameters":["avatar-1752963687318-794504727.jpeg","REMI.jpeg","uploads\\avatars\\avatar-1752963687318-794504727.jpeg","image/jpeg",752464,"image","avatar","Avatar pour SIAKOU Komi Stanislas",5,5,"2025-07-19 22:21:27.376 +00:00","2025-07-19 22:21:27.376 +00:00"],"parent":{"code":"23503","constraint":"audit_logs_user_id_fkey","detail":"La clé (user_id)=(2) n'est pas présente dans la table « users ».","file":"ri_triggers.c","length":827,"line":"2610","name":"error","parameters":["avatar-1752963687318-794504727.jpeg","REMI.jpeg","uploads\\avatars\\avatar-1752963687318-794504727.jpeg","image/jpeg",752464,"image","avatar","Avatar pour SIAKOU Komi Stanislas",5,5,"2025-07-19 22:21:27.376 +00:00","2025-07-19 22:21:27.376 +00:00"],"routine":"ri_ReportViolation","schema":"public","severity":"ERREUR","sql":"INSERT INTO \"file_attachments\" (\"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12) RETURNING \"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"intervention_id\",\"report_id\",\"machine_id\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\",\"uploaded_by\",\"intervention_id\",\"report_id\";","table":"audit_logs","where":"instruction SQL « INSERT INTO audit_logs (\n        user_id,\n        action,\n        entity,\n        entity_id,\n        changes,\n        ip_address,\n        user_agent,\n        created_at\n    ) VALUES (\n        effective_user_id,\n        operation,\n        TG_TABLE_NAME,\n        COALESCE(NEW.id, OLD.id),\n        changes,\n        current_setting('app.current_ip', TRUE),\n        current_setting('app.user_agent', TRUE),\n        NOW()\n    ) »\nfonction PL/pgSQL log_audit_trail(), ligne 28 à instruction SQL"},"sql":"INSERT INTO \"file_attachments\" (\"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12) RETURNING \"id\",\"filename\",\"original_name\",\"path\",\"mimetype\",\"size\",\"category\",\"file_type\",\"description\",\"intervention_id\",\"report_id\",\"machine_id\",\"user_id\",\"uploaded_by\",\"created_at\",\"updated_at\",\"uploaded_by\",\"intervention_id\",\"report_id\";","stack":"Error\n    at Query.run (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\postgres\\query.js:50:25)\n    at F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\sequelize.js:315:28\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PostgresQueryInterface.insert (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-interface.js:308:21)\n    at async model.save (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\model.js:2490:35)\n    at async FileAttachment.create (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\model.js:1362:12)\n    at async updateUser (F:\\gestion-maintenance\\backend\\controllers\\userController.js:177:7)","timestamp":"2025-07-19 22:21:27"}
{"level":"error","message":"Erreur récupération machines: Invalid value { undefined: '%tes%' }","stack":"Error: Invalid value { undefined: '%tes%' }\n    at Object.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\sql-string.js:54:11)\n    at PostgresQueryGenerator.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:766:22)\n    at PostgresQueryGenerator._whereParseSingleValueObject (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2060:41)\n    at PostgresQueryGenerator.whereItemQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1818:19)\n    at F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1737:25\n    at Array.forEach (<anonymous>)\n    at PostgresQueryGenerator.whereItemsQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1735:35)\n    at PostgresQueryGenerator.getWhereConditions (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2078:19)\n    at PostgresQueryGenerator.selectQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:991:28)\n    at PostgresQueryInterface.select (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-interface.js:407:59)","timestamp":"2025-07-19 23:28:34"}
{"level":"error","message":"Erreur récupération machines: Invalid value { undefined: '%tes%' }","stack":"Error: Invalid value { undefined: '%tes%' }\n    at Object.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\sql-string.js:54:11)\n    at PostgresQueryGenerator.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:766:22)\n    at PostgresQueryGenerator._whereParseSingleValueObject (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2060:41)\n    at PostgresQueryGenerator.whereItemQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1818:19)\n    at F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1737:25\n    at Array.forEach (<anonymous>)\n    at PostgresQueryGenerator.whereItemsQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1735:35)\n    at PostgresQueryGenerator.getWhereConditions (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2078:19)\n    at PostgresQueryGenerator.selectQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:991:28)\n    at PostgresQueryInterface.select (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-interface.js:407:59)","timestamp":"2025-07-19 23:28:35"}
{"level":"error","message":"Erreur récupération machines: Invalid value { undefined: '%test%' }","stack":"Error: Invalid value { undefined: '%test%' }\n    at Object.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\sql-string.js:54:11)\n    at PostgresQueryGenerator.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:766:22)\n    at PostgresQueryGenerator._whereParseSingleValueObject (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2060:41)\n    at PostgresQueryGenerator.whereItemQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1818:19)\n    at F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1737:25\n    at Array.forEach (<anonymous>)\n    at PostgresQueryGenerator.whereItemsQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1735:35)\n    at PostgresQueryGenerator.getWhereConditions (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2078:19)\n    at PostgresQueryGenerator.selectQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:991:28)\n    at PostgresQueryInterface.select (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-interface.js:407:59)","timestamp":"2025-07-19 23:28:35"}
{"level":"error","message":"Erreur récupération machines: Invalid value { undefined: '%test%' }","stack":"Error: Invalid value { undefined: '%test%' }\n    at Object.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\sql-string.js:54:11)\n    at PostgresQueryGenerator.escape (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:766:22)\n    at PostgresQueryGenerator._whereParseSingleValueObject (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2060:41)\n    at PostgresQueryGenerator.whereItemQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1818:19)\n    at F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1737:25\n    at Array.forEach (<anonymous>)\n    at PostgresQueryGenerator.whereItemsQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:1735:35)\n    at PostgresQueryGenerator.getWhereConditions (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:2078:19)\n    at PostgresQueryGenerator.selectQuery (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-generator.js:991:28)\n    at PostgresQueryInterface.select (F:\\gestion-maintenance\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-interface.js:407:59)","timestamp":"2025-07-19 23:28:36"}
